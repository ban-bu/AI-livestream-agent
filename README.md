# 直播电商多智能体仿真系统

## 系统概述
本系统是一个基于多智能体的直播电商仿真平台，通过模拟四类核心智能体（消费者、主播、商家、平台）的交互行为，实现对直播电商生态的深入分析。

## 系统架构
系统采用分层架构设计，通过gRPC实现实时数据流：

```
┌───────────────────────┐     gRPC      ┌───────────────────────┐
│  仿真层              │ ←----------→ │  决策层              │
│  - 事件调度器        │              │  - 消费者智能体      │
│  - 时间控制器        │              │  - 主播智能体        │
│  - 数据收集器        │              │  - 商家智能体        │
└───────────────────────┘              │  - 平台智能体        │
       ↓                               └───────────────────────┘
┌───────────────────────┐              ┌───────────────────────┐
│  数据层              │              │  MongoDB数据库        │
│  - 商品池            │              │  - 交易记录          │
│  - 商家档案          │              │  - 智能体状态        │
│  - 主播元数据        │              └───────────────────────┘
└───────────────────────┘
```

## 智能体详解

### 1. 消费者智能体 (Consumer Agent)
消费者智能体模拟真实用户的购物决策过程，具有个性化的消费特征和行为模式。

#### 核心特征
- **消费能力**：根据用户分层（高端、中端、大众）设定预算上限
- **兴趣偏好**：对不同品类商品的偏好权重
- **价格敏感度**：影响购买决策的价格弹性系数（0-1）
- **从众倾向**：受直播间人气和销量影响程度

#### 决策机制
```python
# 购买概率计算
P(购买) = 基础意愿 * 价格系数 * 信任度 * 从众因子

# 其中：
价格系数 = exp(-价格敏感度 * (实际价格/心理预期))
从众因子 = 1 + log(1 + 当前观看人数/基准人数)
```

### 2. 主播智能体 (Streamer Agent)
主播智能体负责商品选择、定价策略和直播间氛围营造。

#### 核心特征
- **影响力等级**：决定直播间基础流量
- **带货能力**：影响商品转化率
- **信誉指数**：影响消费者信任度
- **选品策略**：基于历史数据的商品筛选机制

#### 决策机制
```python
# 商品优先级评分
score = (预期利润 * 0.4 + 历史转化率 * 0.3 + 库存压力 * 0.3) * 季节性系数

# 动态调价策略
折扣力度 = min(1 - (当前销量/目标销量), 最大折扣)
```

### 3. 商家智能体 (Merchant Agent)
商家智能体负责库存管理、定价策略和合作伙伴选择。

#### 核心特征
- **供应能力**：影响库存补充速度
- **价格策略**：成本和利润率设定
- **合作倾向**：与不同等级主播的合作意愿
- **品牌价值**：影响基础定价权重

#### 决策机制
```python
# 库存补充决策
IF 当前库存 < 安全库存线 THEN
    补货数量 = max(预期销量 * 2, 最小订单量)

# 主播选择评分
主播得分 = 粉丝数 * 0.3 + 历史转化率 * 0.4 + 品类匹配度 * 0.3
```

### 4. 平台智能体 (Platform Agent)
平台智能体负责流量分配、活动策划和风险控制。

#### 核心特征
- **流量池管理**：智能分配观众流量
- **活动规划**：制定促销活动策略
- **风控机制**：监控交易异常
- **收益优化**：平台佣金动态调整

#### 决策机制
```python
# 流量分配算法
权重 = 主播等级 * 0.4 + 近期表现 * 0.3 + 活动匹配度 * 0.3

# 佣金费率调整
费率 = 基础费率 * (1 + 季节系数) * 品类系数
```

## 智能体交互机制

### 交互流程
1. 平台智能体分配初始流量
2. 主播智能体选择商品并设定价格
3. 消费者智能体进入直播间并做出购买决策
4. 商家智能体响应订单并更新库存
5. 平台智能体根据实时数据调整流量分配

### 反馈机制
- **实时反馈**：交易数据、用户停留时间
- **周期反馈**：转化率、退货率、复购率
- **长期反馈**：用户粘性、品牌价值提升

## 配置参考
```python
# 智能体基础配置
AGENT_CONFIG = {
    "consumer": {
        "groups": [
            {"type": "高端", "budget": 8000, "price_sensitivity": 0.3},
            {"type": "中端", "budget": 3000, "price_sensitivity": 0.5},
            {"type": "大众", "budget": 1000, "price_sensitivity": 0.8}
        ]
    },
    "streamer": {
        "levels": [
            {"type": "头部", "base_traffic": 1000000, "commission_rate": 0.2},
            {"type": "腰部", "base_traffic": 300000, "commission_rate": 0.15},
            {"type": "新秀", "base_traffic": 50000, "commission_rate": 0.1}
        ]
    }
}
```

## 系统运行阶段

### 1. 初始化阶段

#### 系统配置加载
- **环境参数设置**：加载模拟天数、日志级别等运行参数
- **智能体配置**：读取各类智能体的基础属性和行为参数
- **商品数据初始化**：构建初始商品池，设置基础价格和库存

#### 智能体实例化
- **群体生成**：根据配置创建不同类型的智能体实例
- **属性分配**：为每个智能体分配个性化特征和初始状态
- **关系网络构建**：建立智能体之间的初始合作关系

#### 环境准备
- **时间系统初始化**：设置仿真时钟和事件调度器
- **数据存储准备**：初始化MongoDB连接，创建数据集合
- **监控系统启动**：部署性能监控和数据采集模块

### 2. 运行阶段

#### 事件循环
- **时间推进**：按照设定的时间粒度推进仿真时钟
- **事件触发**：根据时间触发预设的系统事件和智能体行为
- **并发处理**：管理多个智能体的并发决策和行为执行

#### 智能体行为
- **状态更新**：智能体根据环境反馈更新内部状态
- **决策执行**：执行决策机制中定义的行为逻辑
- **交互响应**：处理来自其他智能体的交互请求

#### 数据收集
- **行为日志**：记录智能体的决策过程和行为结果
- **交易数据**：采集交易流水和相关业务指标
- **状态快照**：定期保存系统关键状态数据

### 3. 分析阶段

#### 数据处理
- **数据清洗**：过滤异常数据，处理缺失值
- **指标计算**：统计核心业务指标和行为特征
- **数据聚合**：按不同维度汇总分析结果

#### 性能评估
- **智能体评价**：评估各类智能体的决策效果
- **系统效率**：分析系统运行效率和资源利用
- **目标达成**：衡量预设目标的完成程度

#### 可视化展示
- **趋势图表**：生成关键指标的时间序列图表
- **分布分析**：展示各类数据的分布特征
- **关系网络**：可视化智能体之间的交互网络

## 快速开始
1. 安装依赖：
   ```bash
   pip install -r requirements.txt
   ```

2. 运行仿真：
   ```bash
   python main.py --days=30 --log_level=info
   ```

## 开源协议
MIT协议。详见 [LICENSE](LICENSE) 文件。

python main.py --rounds 2 --save --use-ollama --disable-reuse
